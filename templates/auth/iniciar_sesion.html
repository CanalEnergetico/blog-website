{% extends "base.html" %}
{% block title %}Iniciar sesión – Canal Energético{% endblock %}

{% block content_top %}
  <div class="bg-light p-3 rounded mb-4">
    <h1 class="mb-1">Iniciar sesión</h1>
    <p class="mb-0 text-muted">
      Entra a Canal Energético para comentar y acceder a toda la normativa.
    </p>
  </div>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-6 col-lg-5">
    <form method="post" class="card p-4 shadow-sm" action="{{ url_for('auth.login') }}" novalidate>
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <!-- Email -->
      <div class="form-floating mb-3">
        <input id="email" name="email" type="email" class="form-control"
               placeholder="tucorreo@ejemplo.com" required autofocus
               autocomplete="email" inputmode="email">
        <label for="email">Correo</label>
      </div>

      <!-- Password + ojo -->
      <div class="form-floating mb-2 position-relative">
        <input id="password" name="password" type="password" class="form-control pe-5"
               placeholder="Tu contraseña" required minlength="8" autocomplete="current-password">
        <label for="password">Contraseña</label>

        <button type="button"
                class="btn btn-sm position-absolute top-50 end-0 translate-middle-y me-2"
                id="togglePasswordLogin"
                aria-label="Mostrar contraseña"
                title="Mostrar contraseña">
          <i class="bi bi-eye" id="togglePasswordLoginIcon" aria-hidden="true"></i>
        </button>
      </div>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="1" id="remember" name="remember">
          <label class="form-check-label" for="remember">Recordarme</label>
        </div>
        <a class="small" href="{{ url_for('auth.forgot_password') }}">¿Olvidaste tu contraseña?</a>
      </div>

      <button type="submit" class="btn btn-primary w-100">Entrar</button>

      <p class="text-muted small mt-3 mb-0">
        ¿No tienes cuenta? <a href="{{ url_for('auth.registrarse') }}">Crea una aquí</a>.
      </p>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Toggle ojo (login)
  (function () {
    const btn  = document.getElementById("togglePasswordLogin");
    const icon = document.getElementById("togglePasswordLoginIcon");
    const field = document.getElementById("password");
    if (!btn || !icon || !field) return;

    btn.addEventListener("click", () => {
      const isPassword = field.getAttribute("type") === "password";
      field.setAttribute("type", isPassword ? "text" : "password");
      icon.classList.toggle("bi-eye", !isPassword);
      icon.classList.toggle("bi-eye-slash", isPassword);
      btn.setAttribute("aria-label", isPassword ? "Ocultar contraseña" : "Mostrar contraseña");
      btn.setAttribute("title", isPassword ? "Ocultar contraseña" : "Mostrar contraseña");
    });
  })();
</script>
{% endblock %}
